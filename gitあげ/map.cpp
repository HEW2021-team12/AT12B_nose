/*==============================================================================

   マップ管理 [map.cpp]
	Author :	歐
	Date   :
--------------------------------------------------------------------------------

==============================================================================*/

#include "input.h"
#include "texture.h"
#include "sprite.h"
#include "map.h"
#include "player.h"

//*****************************************************************************
// マクロ定義
//*****************************************************************************


//*****************************************************************************
// プロトタイプ宣言
//*****************************************************************************


//*****************************************************************************
// グローバル変数
//*****************************************************************************
static	int g_MapTexture = 0;
MAP		g_map;

//=============================================================================
// 初期化処理
//=============================================================================
void InitMap(void)
{
	g_MapTexture = LoadTexture("data/TEXTURE/map2.png");
	g_map.pos.x = SCREEN_WIDTH / 2;
	g_map.pos.y = SCREEN_HEIGHT / 2;
	g_map.size.x = SCREEN_WIDTH;
	g_map.size.y = SCREEN_HEIGHT;
	for (int i = 0; i < 4; i++)
	{
		g_map.uv[i] = 0.0f;
	}
	
}

//=============================================================================
// 終了処理
//=============================================================================
void UninitMap(void)
{

}

//=============================================================================
// 更新処理
//=============================================================================
void UpdateMap(void)
{
	ChangeUv();
}

//=============================================================================
// 描画処理
//=============================================================================
void DrawMap(void)
{
	D3DXCOLOR col = D3DXCOLOR(1.0f, 1.0f, 1.0f, 1.0f);

	DrawSpriteColorRotate(g_MapTexture,
		g_map.pos.x, g_map.pos.y,
		g_map.size.x, g_map.size.y,
		g_map.uv[0], g_map.uv[1],
		g_map.uv[2], g_map.uv[3],
		col, 0.0f);
}

void ChangeUv(void)
{
	float u, v,uw,vh;

	u = GetPlayer()->pos.x / SCREEN_WIDTH - view_size;
	v = GetPlayer()->pos.y / SCREEN_HEIGHT - view_size;
	uw = GetPlayer()->pos.x / SCREEN_WIDTH + view_size - u;
	vh = GetPlayer()->pos.y / SCREEN_HEIGHT+ view_size - v;

	g_map.uv[0] = u;
	g_map.uv[1] = v;
	g_map.uv[2] = uw;
	g_map.uv[3] = vh;
}